<div ng-init="ctrl.initData()" >
    <div class="row titleholder">
        <div class="col-md-4">
            <div class="moduletitle">
                <h3><b>{{ExpenseVM.Expense.Type=="ProductPurchase"?"Product Purchase":ExpenseVM.Expense.Type=="Bill"?"Bill":""}}</b></h3>
            </div>
        </div>
        <div class="pull-right">
            <a class="btn btn-primary" ng-show="ExpenseVM.Expense.isedit==false&&ExpenseVM.Expense.allowedit==true"
                    ng-click="startEditExpense() "><i class="glyphicon glyphicon-pencil"></i>&nbsp;Edit</a>
            <a class="btn btn-primary" ng-show="ExpenseVM.Expense.isedit==true" ng-click="finishEditExpense()"><i
                    class="glyphicon glyphicon-ok"></i>&nbsp;Save</a>&nbsp;
            <a class="btn btn-primary" ng-show="ExpenseVM.Expense.isedit==true" ng-click="cancelEditExpense()"><i
                    class="glyphicon glyphicon-refresh"></i>&nbsp;Cancel</a>
            &nbsp;<a class="btn btn-primary" ng-show="ExpenseVM.Expense.allowdelete==true" ng-click="removeExpense()"><i
                class="glyphicon glyphicon-remove"></i>&nbsp;Delete</a>
            &nbsp;<a class="btn btn-primary" ui-sref="expense.management"> <i
                class="glyphicon glyphicon-chevron-left"></i>Back</a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="row" ng-show="Processing.GetProcessing('Expense').Value">
                <div class="col-md-6 col-md-offset-6" style="position: absolute">
                    <img src="images/loading-bars.svg" width="64" height="64" alt="Loading..."/>
                </div>
            </div>
        </div>
    </div>
    <div class="row formsection">
        <div class="col-md-12">
            <div class="row" ng-show="ExpenseVM.Expense.isedit == false" >
                <div class="col-md-12">
                    <div class="col-md-6">
                        <label class="control-label"> Name</label>
                        {{ExpenseVM.Expense.Description}}
                    </div>
                    <div class="col-md-6">
                        <label class="control-label">Date</label>
                        {{ExpenseVM.Expense.InvoiceDateF}}
                    </div>
                    <div class="col-md-6">
                        <label class="control-label">Reference</label>
                        {{ExpenseVM.Expense.InvoiceNo}}
                    </div>


                </div>
            </div>
            <div class="row" ng-show="ExpenseVM.Expense.isedit == true">
                <div class="col-md-12">
                    <div class="row">
                    <div class="col-md-6">
                        <label class="control-label" for="ctrlDescription">Name</label>
                        <input id="ctrlDescription" type="text" ng-model="ExpenseVM.Expense.Description"
                                ng-change="onChangeExpense_Description(ExpenseVM.Expense)"
                                ng-class="[{'validateinput':ValManager().Get('Description').IsValid==false}]"
                                class="form-control"/>

                        <div class="col-md-12" style="color: Red" >
                            <span ng-visible="ExpenseVM.Expense.valmanager.Get('Description').IsValid==false&&ExpenseVM.Expense.valmanager.Get('Description').ValMsg!=''">{{ExpenseVM.Expense.valmanager.Get('Description').ValMsg}}</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="control-label" for="ctrlInvoiceDate">Date</label>
                        <input id="ctrlInvoiceDate" type="date" ng-model="ExpenseVM.Expense.InvoiceDate"
                                class="form-control col-md-12" ng-change="onChangeExpense_InvoiceDate(ExpenseVM.Expense)"
                                ng-class="[{'validateinput':ValManager().Get('InvoiceDate').IsValid==false}]"/>
                        <div class="col-md-12" style="color: Red" >
                            <span ng-visible="ExpenseVM.Expense.valmanager.Get('InvoiceDate').IsValid==false&&ExpenseVM.Expense.valmanager.Get('InvoiceDate').ValMsg!=''">{{ExpenseVM.Expense.valmanager.Get('InvoiceDate').ValMsg}}</span>
                        </div>
                    </div>
                    </div>
                    <div class="row">
                    <div class="col-md-6">
                        <label class="control-label" for="ctrlInvoiceNo">Reference</label>
                        <input id="ctrlInvoiceNo" type="text" ng-model="ExpenseVM.Expense.InvoiceNo"
                                class="form-control col-md-12"/>
                    </div>
                        <div class="col-md-6" ng-show="ExpenseVM.Expense.Type == 'ProductPurchase'">
                            <label class="control-label" for="ctrlUpdateStock">Update Stock</label><br/>
                            <input id="ctrlUpdateStock" type="checkbox" ng-model="ExpenseVM.Expense.UpdateStock"
                                    icheck/>
                        </div>
                    </div>
                </div>
                <div class="col-md-12" style="color: Red" >
                    <span ng-visible="ExpenseVM.Expense.valmanager.Get('DetailLength').IsValid==false&&ExpenseVM.Expense.valmanager.Get('DetailLength').ValMsg!=''">{{ExpenseVM.Expense.valmanager.Get('DetailLength').ValMsg}}</span>
                </div>
            </div>
        </div>
    </div>
    <div class="row formsection" >
        <div class="col-md-12">
            <label class="formsectiontitle">Expense Details</label>
            <a class="btn btn-default pull-right" ng-show="ExpenseVM.Expense!=null&&ExpenseVM.Expense.isedit&&ExpenseVM.Expense.Type=='Bill'"
                    ng-click="startAddExpenseDetail()"><i class="glyphicon glyphicon-plus"
                    title="Add ExpenseDetail "></i> &nbsp; Add Item</a>
            <a class="btn btn-default pull-right" ng-show="ExpenseVM.Expense!=null&&ExpenseVM.Expense.isedit&&ExpenseVM.Expense.Type=='ProductPurchase'"
                    ng-click="startAddPopupExpenseDetail()"><i class="glyphicon glyphicon-plus"
                    title="Add Expense Detail "></i> &nbsp; Add Item</a>
        </div>
        <div class="col-md-12">
            <div id="gridExpenseDetail" class='contenttable'>
                <table width="100%" class="table table-bordered table-hover" style="min-width:700px">
                    <thead>
                    <tr>
                        <td class="k-header" style="text-align: center"></td>
                        <td class="k-header" style="text-align:center;" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">Product
                        </td>
                        <td class="k-header" style="text-align:center;" ng-show="ExpenseVM.Expense.Type=='Bill'"> Name
                        </td>
                        <td class="k-header" style="text-align:center;"  ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">Quantity
                        </td>
                        <td class="k-header" style="text-align:center;" >Price
                        </td>
                        <td class="k-header" style="text-align:center;" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">Total
                        </td>
                    </tr>
                    </thead>
                    <tbody ng-repeat="item in ExpenseDetailsVM.ArrExpenseDetail">
                    <tr ng-show="item.isedit==false&&item.editmode!='Delete'" ng-class="{'normalrow':(($index%2)==0),'alternativerow':($index%2!=0)}">
                        <td style="text-align:center" class="col-md-1"></td>
                        <td class="col-md-4" >
                            {{item.ItemName}}
                        </td>
                        <td class="col-md-2"  ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">
                            {{item.Quantity}}
                        </td>
                        <td class="col-md-2">
                            $ {{item.UnitPrice}}
                        </td>
                        <td class="col-md-2" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">
                            $ {{item.Total}}
                        </td>
                    </tr>
                    <tr ng-show="item.isedit==true&&item.editmode!='Delete'" ng-class="{'normalrow':(($index%2)==0),'alternativerow':($index%2!=0)}">
                        <td class="col-md-1" style="text-align:center">
                            <button class="btn btn-sm" ng-show="item.allowremove == true"
                                    ng-click="removeListExpenseDetail(item)" title="Delete"><i
                                    class="glyphicon glyphicon-trash"></i></button>
                        </td>
                        <td class="col-md-4" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">
                            {{item.ItemName}}
                        </td>
                        <td class="col-md-4" ng-show="ExpenseVM.Expense.Type=='Bill'">
                            <input type="text" ng-model="item.ItemName" ng-change="onChangeExpenseDetail_ItemName(item)"
                                    ng-class="[{'validateinput':ValManager().Get('ItemName').IsValid==false}]"
                                    class="form-control"/>

                            <div class="col-md-12" style="color: Red" >
                                <span ng-visible="item.valmanager.Get('ItemName').IsValid==false&&item.valmanager.Get('ItemName').ValMsg!=''">{{item.valmanager.Get('ItemName').ValMsg}}</span>
                            </div>
                        </td>
                        <td class="col-md-2" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">
                            <input type="number" ng-model="item.Quantity"
                                    ng-change="onChangeExpenseDetail_Quantity(item)"
                                    ng-class="[{'validateinput':ValManager().Get('Quantity').IsValid==false}]"
                                    class="form-control"/>

                            <div class="col-md-12" style="color: Red" >
                                <span ng-visible="item.valmanager.Get('Quantity').IsValid==false&&item.valmanager.Get('Quantity').ValMsg!=''">{{item.valmanager.Get('Quantity').ValMsg}}</span>
                            </div>
                        </td>
                        <td class="col-md-2" >
                            <input type="number" ng-model="item.UnitPrice" class="form-control col-md-12" ng-change="onChangeExpenseDetail_UnitPrice(item)"
                                    ng-class="[{'validateinput':ValManager().Get('UnitPrice').IsValid==false}]"
                                   />

                            <div class="col-md-12" style="color: Red" >
                                <span ng-visible="item.valmanager.Get('UnitPrice').IsValid==false&&item.valmanager.Get('UnitPrice').ValMsg!=''">{{item.valmanager.Get('UnitPrice').ValMsg}}</span>
                            </div>
                        </td>
                        <td class="col-md-2" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'" >
                            <input type="number" ng-model="item.Total" class="form-control col-md-12" readonly="readonly"/>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td class="col-md-1" style="text-align:center">
                        </td>
                        <td class="col-md-4" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">
                        </td>
                        <td class="col-md-4"  ng-show="ExpenseVM.Expense.Type=='Bill'">
                        </td>
                        <td class="col-md-2" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">
                        </td>
                        <td class="col-md-2" ng-show="ExpenseVM.Expense.Type=='ProductPurchase'">
                        </td>
                        <td class="col-md-2" >
                            $ {{ ExpenseVM.Expense.Amount}}
                        </td>
                     
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="popupProduct" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="padding: 5px 5px;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h5 class="modal-title">Search Product</h5>
            </div>
            <div class="modal-body" ng-if="SearchProductsVM!=null">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row" ng-show="SearchProductsVM.Processing.GetProcessing('Products').Value">
                            <div class="col-md-6 col-md-offset-6" style="position: absolute">
                                <img src="images/loading-bars.svg" width="64" height="64" alt="Loading..."/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div role="tabpanel">
                            <!-- Nav tabs -->
                            <ul id="myTab" class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active"><a href="#tabproduct" aria-controls="product"
                                        role="tab" data-toggle="tab">Product</a></li>
                                <li role="presentation"><a href="#tabselectedproduct" aria-controls="incometracking"
                                        role="tab" data-toggle="tab">Selected ( {{
                                    SearchProductsVM.ArrSProduct.length}} )</a></li>
                            </ul>
                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="tabproduct">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>Type</label>
                                            <select ng-model="SearchProductsVM.GetSearchParam('Type').Value"
                                                    class="form-control" ng-change="SearchProductsVM.searchProducts()">
                                                <option value="">Select Type</option>
                                                <option value="Product">Product</option>
                                                <option value="Service">Service</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Name</label>
                                            <input type="text" ng-model="SearchProductsVM.GetSearchParam('Name').Value"
                                                    class="form-control" ng-change="SearchProductsVM.searchProducts()"/>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Category</label>
                                                <ui-select id="ctrlSearchCategory" ng-model="SearchProductsVM.GetSearchParam('CategoryId').Value" theme="bootstrap" ng-change="SearchProductsVM.searchProducts()" >
                                                    <ui-select-match placeholder="Select Category">{{$select.selected.Name}}</ui-select-match>
                                                    <ui-select-choices repeat="obj.Id as obj in CategorysVM.ArrCategory|filter:{Name: $select.search}">
                                                        <div ng-bind-html="obj.Name | highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="contenttable">
                                                <table width="100%" class="table table-bordered table-striped table-hover" style="min-width:700px;">
                                                <thead>
                                                <tr>
                                                    <td class="k-header" style="text-align: center"></td>
                                                    <td class="k-header" style="text-align: center; cursor: pointer">
                                                        Name
                                                    </td>
                                                    <td class="k-header" style="text-align: center; cursor: pointer">
                                                        Item
                                                        Price
                                                    </td>
                                                    <td class="k-header" style="text-align: center; cursor: pointer">
                                                        Stock
                                                        Unit
                                                    </td>

                                                </tr>
                                                </thead>
                                                <tbody ng-repeat="item in SearchProductsVM.ArrProduct">
                                                <tr ng-class="{'normalrow':(($index%2)==0),'alternativerow':($index%2!=0)}">
                                                    <td style="text-align: center" class="col-md-2">
                                                        <button class="btn btn-default" ng-click="selectProduct(item)"
                                                                title="Add"><i class="glyphicon glyphicon-plus"></i>
                                                        </button>
                                                    </td>
                                                    <td class="col-md-3">
                                                        {{item.Name}}
                                                    </td>
                                                    <td class="col-md-2">
                                                        <span> $ {{ item.UnitPrice }}</span>
                                                    </td>
                                                    <td class="col-md-1">
                                                        {{ item.UnitsInStock }}
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr>
                                                    <td colspan="4">
                                                        <div class="row">
                                                            <div class=" col-md-12">
                                                                <div class="pull-right">
                                                                    <ul class="pagination">
                                                                        <li><a>Total <b>{{
                                                                            SearchProductsVM.Paging.TotalItems }}</b>
                                                                            items
                                                                            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Page <b>{{SearchProductsVM.Paging.PageIndex}}
                                                                                / {{SearchProductsVM.Paging.TotalPages
                                                                                }}</b></a></li>
                                                                        <li ng-class="{disabled: SearchProductsVM.Paging.PageIndex==1}">
                                                                            <a ng-click="SearchProductsVM.gotoPrevPage()">&laquo;</a>
                                                                        </li>
                                                                        <li ng-repeat-start="page in SearchProductsVM.Paging.Pages"
                                                                                ng-class="{active: page == SearchProductsVM.Paging.PageIndex}">
                                                                            <a ng-click="SearchProductsVM.gotoPage(page)">{{page}}</a>
                                                                        </li>
                                                                        <li ng-repeat-end class="divider"></li>
                                                                        <li ng-class="{disabled:SearchProductsVM.Paging.PageIndex >= SearchProductsVM.Paging.TotalPages}">
                                                                            <a ng-click="SearchProductsVM.gotoNextPage()">&raquo;</a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div role="tabpanel" class="tab-pane" id="tabselectedproduct"
                                        style="padding-bottom: 10px;">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="contenttable">
                                                <table width="100%" class="table table-bordered table-striped table-hover" style="min-width:700px;">
                                        <thead>
                                        <tr>
                                            <td class="k-header" style="text-align: center"></td>
                                            <td class="k-header" style="text-align: center; cursor: pointer">Name
                                            </td>
                                            <td class="k-header" style="text-align: center; cursor: pointer">Item Price
                                            </td>
                                            <td class="k-header" style="text-align: center; cursor: pointer">Stock Unit
                                            </td>

                                        </tr>
                                        </thead>
                                        <tbody ng-repeat="item in SearchProductsVM.ArrSProduct">
                                        <tr ng-class="{'normalrow':(($index%2)==0),'alternativerow':($index%2!=0)}">
                                            <td style="text-align: center" class="col-md-2">
                                                <button class="btn btn-default" ng-click="unselectProduct(item)"
                                                        title="Add"><i class="glyphicon glyphicon-remove"></i></button>
                                            </td>
                                            <td class="col-md-3">
                                                {{item.Name}}
                                            </td>
                                            <td class="col-md-2">
                                                <span> $ {{ item.UnitPrice }}</span>
                                            </td>
                                            <td class="col-md-1">
                                                {{ item.UnitsInStock }}
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="pull-right">
                    <button class="btn btn-default" ng-click="finishAddPopupProduct()">Finish</button>
                    &nbsp;
                    <button type="button" class="btn  btn-default" data-dismiss="modal">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div></div>